<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PDAltmode Middleware Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PDAltmode Middleware Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">PDAltMode Middleware Library Documentation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The PDAltMode middleware implements state machines defined in:</p><ul>
<li><b>Universal Serial Bus Power Delivery Specification Rev 3.1 Ver 1.8</b></li>
<li><b>Universal Serial Bus Type-C Cable and Connector Specification Ver 2.2</b></li>
<li><b>VESA DisplayPort Alt Mode on USB Type-C Standard. Ver 1.3/1.4</b></li>
</ul>
<p>The PDAltMode middleware operates on top of PdStack Middleware and USBPD driver included in the MTB PDL CAT2 (mtb-pdl-cat2) Peripheral Driver Library. The middleware provides a set of Alt Mode APIs through which the application can initialize, monitor and configure the following PD Alt Modes:</p><ul>
<li>Display Port.</li>
<li>TBT.</li>
<li>vPro.</li>
<li>USB4.</li>
</ul>
<p>The PDAltMode Middleware is released as a combination of source files and a pre-compiled library (pdaltmode_dock_tbt). The pre-compiled library implements support for TBT and vPro alternate modes. All of the remaining state machines are implemented in the form of source files.</p>
<p><b>Features:</b></p><ol type="1">
<li>Support PD Alternate Modes Discovery, entry and simultaneously handling up to 4 alternate modes.</li>
<li>Support Intel Ridge Slave Interface.</li>
<li>Support the following AltModes (in DFP and UFP roles) by default:<ul>
<li>DP</li>
<li>TBT</li>
<li>vPro</li>
<li>USB4</li>
</ul>
</li>
<li>Support mechanisms to add user custom alternate mode.</li>
</ol>
<h1><a class="anchor" id="section_pdaltmode_quick_start"></a>
Quick Start Guide</h1>
<p>PDAltMode Middleware can be used in various development environments such as ModusToolbox(TM), MBED, and so on. Refer to the <a class="el" href="index.html#section_pdaltmode_toolchain">Supported Software and Tools</a> section.</p>
<p>The following steps describe the simplest way of enabling the PDAltMode Middleware in the application.</p>
<ol type="1">
<li>Open/Create an application where PdAltMode functionality is needed.</li>
<li>Add the PDAltMode Middleware to your project. This quick start guide assumes that the environment is configured to use the MTB CAT2 Peripheral Driver Library(PDL) for development and the PDL is included in the project. If you are using the ModusToolbox(TM) development environment, select the application in the Project Explorer window and select the PDAltMode Middleware in the Library Manager.</li>
<li>Include cy_pdaltmode_defines.h, cy_pdaltmode_vdm_task.h, cy_pdaltmode_mngr.h and cy_pdaltmode_hw.h header files to get access to common Alternate Modes functionality as Discovery process and Alternate Modes handling. <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;cy_pdaltmode_defines.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;cy_pdaltmode_vdm_task.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;cy_pdaltmode_mngr.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;cy_pdaltmode_hw.h&quot;</span></div></div><!-- fragment --></li>
<li>Include desired Alternate Mode header/source files to get access to selected Alternate Mode. For example, for DisplayPort Alternate Mode, include next header file: <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;cy_pdaltmode_dp_sid.h&quot;</span></div></div><!-- fragment --></li>
<li>Define the following data structures, pointers (or) configuration required by the PDAltMode Middleware: <div class="fragment"><div class="line"><span class="comment">/*******************************************************************************</span></div><div class="line"><span class="comment">* Alternate mode Port Configuration Structure Initialization</span></div><div class="line"><span class="comment">*******************************************************************************/</span></div><div class="line"><span class="keywordtype">void</span> Cy_PdAltMode_Mngr_ContextInit(<a class="code" href="group__group__pdaltmode__common__data__structures.html#structcy__stc__pdaltmode__context__t">cy_stc_pdaltmode_context_t</a> *ptrAltModeContext, cy_stc_pdstack_context_t *ptrPdStackContext)</div><div class="line">{</div><div class="line">    cy_stc_usbpd_context_t *ptrUsbPdContext = ptrPdStackContext-&gt;ptrUsbPdContext;</div><div class="line"></div><div class="line">    ptrAltModeContext-&gt;<a class="code" href="group__group__pdaltmode__common__data__structures.html#aba3f2832d6acbf0f5c866d67f8e0090b">appStatusContext</a> = app_pd_get_status(ptrUsbPdContext-&gt;port);</div><div class="line">    ptrAltModeContext-&gt;<a class="code" href="group__group__pdaltmode__common__data__structures.html#a0032d80be91c77ede3050a07d3867390">altModeAppStatus</a> = <a class="code" href="group__group__pdaltmode__vdm__alt__mode__manager__functions.html#gaa07ffabf22d61e39aef956f9beed3b8b">Cy_PdAltMode_Mngr_GetAmStatus</a>(ptrUsbPdContext-&gt;port);</div><div class="line">    ptrAltModeContext-&gt;<a class="code" href="group__group__pdaltmode__common__data__structures.html#a5790555497ca6a84993a77fced6c6379">hwDetails</a>        = <a class="code" href="group__group__pdaltmode__alt__mode__hw__functions.html#gae85a95014094eb8548fd5c251fc62347">Cy_PdAltMode_HW_GetStatus</a>(ptrUsbPdContext-&gt;port);</div><div class="line"></div><div class="line">    <span class="comment">/* Init AM asset structures pointers */</span></div><div class="line"><span class="preprocessor">#if (DFP_ALT_MODE_SUPP || UFP_ALT_MODE_SUPP)</span></div><div class="line">    ptrAltModeContext-&gt;<a class="code" href="group__group__pdaltmode__common__data__structures.html#a64b83390d1e5bb109789b5f261897199">altModeMngrStatus</a> = <a class="code" href="group__group__pdaltmode__vdm__alt__mode__manager__functions.html#ga3f3adc38c3ebf530b8b7eb15daaf4761">Cy_PdAltMode_Mngr_GetMngrStatus</a>(ptrUsbPdContext-&gt;port);</div><div class="line">    ptrAltModeContext-&gt;<a class="code" href="group__group__pdaltmode__common__data__structures.html#a33d69fea0c550c5b43833b24040699f2">vdmStat</a>           = <a class="code" href="group__group__pdaltmode__vdm__alt__mode__manager__functions.html#ga8da1801387db0bfc422d88ab713ee765">Cy_PdAltMode_VdmTask_GetMngrStatus</a>(ptrUsbPdContext-&gt;port);</div><div class="line"><span class="preprocessor">#if ((DP_DFP_SUPP) || (DP_UFP_SUPP))</span></div><div class="line">    <span class="comment">/* Init DisplayPort structure */</span></div><div class="line">    ptrAltModeContext-&gt;<a class="code" href="group__group__pdaltmode__common__data__structures.html#aff9afd3792552eeaeaf18cb022953653">dpStatus</a>          = <a class="code" href="group__group__pdaltmode__display__port__functions.html#ga8660302a2d70c94169d7ded455621301">Cy_PdAltMode_DP_GetStatus</a>(ptrUsbPdContext-&gt;port);</div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* DP_DFP_SUPP || DP_UFP_SUPP */</span><span class="preprocessor"></span></div><div class="line"><span class="preprocessor">#if STORE_DETAILS_OF_HOST</span></div><div class="line">    cptrAltModeContext-&gt;hostDetails      = <a class="code" href="group__group__pdaltmode__intel__functions.html#gacfdcf05cc7ed0d5e66a516e43406ff1c">Cy_PdAltMode_HostDetails_GetStatus</a>(ptrUsbPdContext-&gt;port)</div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* STORE_DETAILS_OF_HOST */</span><span class="preprocessor"></span></div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* DFP_ALT_MODE_SUPP || UFP_ALT_MODE_SUPP */</span><span class="preprocessor"></span></div><div class="line">    ptrAltModeContext-&gt;<a class="code" href="group__group__pdaltmode__common__data__structures.html#a34f18ac1a604068a73e013c483d55104">pdStackContext</a>   = ptrPdStackContext;</div><div class="line">    ptrAltModeContext-&gt;<a class="code" href="group__group__pdaltmode__common__data__structures.html#a35f7d32a2f42b36992cf929c7cb62629">noOfTypeCPorts</a>   = NO_OF_TYPEC_PORTS();</div><div class="line"></div><div class="line">    <span class="comment">/* Get pointers to configuration structures */</span></div><div class="line">    ptrAltModeContext-&gt;<a class="code" href="group__group__pdaltmode__common__data__structures.html#aceb31ed4d6db842a86597557af80d116">altModeCfg</a>       = pd_get_ptr_base_alt_tbl(ptrUsbPdContext);</div><div class="line">    ptrAltModeContext-&gt;<a class="code" href="group__group__pdaltmode__common__data__structures.html#ac51b717d9cdeb53a55abd0046410c383">altModeCfgLen</a>    = get_pd_port_config(ptrUsbPdContext)-&gt;port_n_base_alt_mode_table_len;</div><div class="line">    ptrAltModeContext-&gt;<a class="code" href="group__group__pdaltmode__common__data__structures.html#a5294cf1776a4145b418b06b2e785c474">tbtCfg</a>           = pd_get_ptr_tbt_host_tbl(ptrUsbPdContext);</div><div class="line">    ptrAltModeContext-&gt;<a class="code" href="group__group__pdaltmode__common__data__structures.html#a51a744b85e46a2852636ef9bc375be2b">dpCfg</a>            = pd_get_ptr_dp_config_tbl(ptrUsbPdContext);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/* Initialize the alternate mode Context if the system is dual port. */</span></div><div class="line">    <span class="keywordflow">if</span>(TYPEC_PORT_1_IDX == ptrUsbPdContext-&gt;port)</div><div class="line">    {</div><div class="line">        gl_AltModePort0Ctx.ptrAltPortAltmodeCtx = &amp;gl_AltModePort1Ctx;</div><div class="line">        gl_AltModePort1Ctx.ptrAltPortAltmodeCtx = &amp;gl_AltModePort0Ctx;</div><div class="line"></div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        ptrAltModeContext-&gt;<a class="code" href="group__group__pdaltmode__common__data__structures.html#ac963c033cb47909cf986377cd328fc63">ptrAltPortAltmodeCtx</a> = NULL;</div><div class="line">    }</div><div class="line">}</div><div class="line"></div></div><!-- fragment --></li>
<li>Enable next macros:<ul>
<li><b>DFP_ALT_MODE_SUPP UFP_ALT_MODE_SUPP</b> to enable DFP/UFP Alternate Modes functionality</li>
<li><b>DP_DFP_SUPP DP_UFP_SUPP</b> to enable DisplayPort DFP/UFP Alternate Modes functionality</li>
<li><b>CY_PD_USB4_SUPPORT_ENABLE</b> to enable USB4 functionality</li>
<li><b>STORE_DETAILS_OF_HOST</b> to enable Dock exchange capabilities functionality</li>
</ul>
</li>
<li>Configure supported Alternate Modes using next sections in <a href=" https://www.infineon.com/cms/en/design-support/tools/configuration/usb-ez-pd-configuration-utility/"><b>EZ-PD Configuration Utility:</b> </a><ul>
<li><b>Base Alternate Modes</b> - Configures supported Alternate Modes SVIDs, data role supported for selected SVID, and modes entry priority.</li>
<li><b>DP Mode Parameters</b> - DisplayPort related configurations.</li>
</ul>
</li>
<li>Register desired Alternate Mode callback function (for ex. Display port): <div class="fragment"><div class="line">    <a class="code" href="group__group__pdaltmode__vdm__alt__mode__manager__data__structures.html#structcy__stc__pdaltmode__alt__mode__reg__info__t">cy_stc_pdaltmode_alt_mode_reg_info_t</a> regInfo;</div><div class="line">    (void) <a class="code" href="group__group__pdaltmode__display__port__functions.html#gaeba07b7dee629cbad9c6d4c6cfdb12a1">Cy_PdAltMode_DP_RegModes</a>(&amp;pdStackContext, &amp;regInfo);</div></div><!-- fragment --> The PDAltMode library uses these set of configuration for running internal state machine that implement different PD Alternate Modes.</li>
<li>Initialize the PDAltMode Middleware once at the start. <div class="fragment"><div class="line">    Cy_PdStack_Dpm_AltModeInitContext(&amp;gl_AltModePort0Ctx, &amp;gl_PdStackPort0Ctx);</div></div><!-- fragment --></li>
<li>Start the VDM and Alt Mode Managers operations and start state machines that control external mux. <div class="fragment"><div class="line">    (void)<a class="code" href="group__group__pdaltmode__vdm__alt__mode__manager__functions.html#ga2ef6ffe7eff6a19712066f4c3d9bbddc">Cy_PdAltMode_VdmTask_Enable</a>(&amp;gl_AltModePort0Ctx);</div></div><!-- fragment --></li>
<li>Invoke Cy_PdAltMode_Manager_Task and Cy_PdAltMode_VdmTask_Manager functions from the main processing loop of the application to handle the Vdm and Alt Mode Managers tasks for each PD port. <div class="fragment"><div class="line">    (void)<a class="code" href="group__group__pdaltmode__vdm__alt__mode__manager__functions.html#ga73731ef5080475c3e99ca3595bd08725">Cy_PdAltMode_Mngr_Task</a>(&amp;gl_AltModePort0Ctx);</div><div class="line">    (void)<a class="code" href="group__group__pdaltmode__vdm__alt__mode__manager__functions.html#gab6c935c30c71fd0e04c90c3298f787fa">Cy_PdAltMode_VdmTask_Manager</a>(&amp;gl_AltModePort0Ctx);</div></div><!-- fragment --></li>
</ol>
<h1><a class="anchor" id="section_pdaltmode_toolchain"></a>
Supported Software and Tools</h1>
<p>This version of the PDAltMode Middleware was validated for the compatibility with the following software and tools:</p>
<table class="doxtable">
<tr>
<th>Software and Tools </th><th>Version  </th></tr>
<tr>
<td>ModusToolbox(TM) software environment </td><td>3.1  </td></tr>
<tr>
<td>mtb-pdl-cat2 </td><td>2.4.0  </td></tr>
<tr>
<td>pdstack </td><td>3.1.0  </td></tr>
<tr>
<td>GCC Compiler </td><td>10.3.1  </td></tr>
<tr>
<td>IAR Compiler </td><td>8.42.2  </td></tr>
<tr>
<td>Arm(R) Compiler 6 </td><td>6.13  </td></tr>
</table>
<h1><a class="anchor" id="section_pdaltmode_changelog"></a>
Changelog</h1>
<table class="doxtable">
<tr>
<th>Version</th><th>Changes</th><th>Reason for change </th></tr>
<tr>
<td>1.0 </td><td>Initial version </td><td></td></tr>
</table>
<h1><a class="anchor" id="section_pdaltmode_more_information"></a>
More Information</h1>
<p>For more information, see the following resources:</p>
<ul>
<li><a href=" https://www.infineon.com/modustoolbox"><b>ModusToolbox(TM) software, quick start guide, documentation, and videos</b> </a></li>
<li><a href="https://infineon.github.io/mtb-pdl-cat2/pdl_api_reference_manual/html/index.html"><b>PDL API Reference Manual</b></a> </li>
<li><a href="https://infineon.github.io/pdstack/pdstack_api_reference_manual/html/index.html"><b>PDStack API Reference Manual</b></a></li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The links to the other software component's documentation (middleware and PDL) point to GitHub for the latest available version of the software. To get documentation of the specified version, download from GitHub, and unzip the component archive. The documentation is available in the <em>docs</em> folder. </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>PDAltmode Middleware Library</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
